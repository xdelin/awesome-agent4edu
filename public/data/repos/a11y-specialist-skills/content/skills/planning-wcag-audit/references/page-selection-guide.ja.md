[English](./page-selection-guide.md)

# ページ選定ガイド

サイト規模と監査目的に応じて対象ページを選定します。対象ページが未定の場合は、URL収集からサンプリングまでこのガイドに従って実施してください。

## 概要

```
1. URL一覧の取得
   ↓
2. 除外設定（ユーザー指定）
   ↓
3. 代表ページの特定
   ↓
4. ランダムサンプリング（代表ページ除外）
   ↓
5. 重複チェック・統合
   ↓
6. 最終確認
```

## サンプル数の目安

基本は **約40ページ** を目標とします。**半数以上を代表ページ**とし、残りをランダムサンプルで補完します。

| サイト規模（除外後） | 対象ページ数 |
|---------------------|-------------|
| 〜40ページ | 全ページ |
| 40ページ以上 | 約40ページ（代表20-25 + ランダム15-20） |
| 200ページ以上 | 40-55ページ（代表25-30 + ランダム15-25） |

サイト規模が小さくても、似たようなページでない限りは40ページ程度をテストすることを推奨します。

---

## Step 1: URL一覧の取得

### 優先順位
1. **sitemap.xml**（あれば最優先）
2. **ユーザー提供のURL一覧**（CSV/テキスト）
3. **Playwrightでリンク収集**（フォールバック）

### sitemap.xml の確認
```bash
curl -s https://example.com/sitemap.xml | grep -oP '(?<=<loc>)[^<]+'
```

### Playwrightでリンク収集
主要な一覧ページを巡回してリンクを収集します。

```javascript
// 巡回するページ例
const pagesToVisit = [
  '/',
  '/products/',
  '/news/',
  '/blog/',
];

// 各ページで内部リンクを収集
const links = await page.evaluate(() =>
  Array.from(document.querySelectorAll('a[href^="/"]'))
    .map(a => a.href)
    .filter((v, i, a) => a.indexOf(v) === i)
);
```

---

## Step 2: 除外設定

同一テンプレートの大量ページや、監査対象外のページを除外します。

### 除外パターン例
| パターン | 理由 |
|---------|------|
| `/download/[0-9]+` | 個別資料ページ（一覧で代表） |
| `/news/[0-9]+` | 個別ニュース（一覧で代表） |
| `/seminar/[0-9]+` | 個別セミナー（一覧で代表） |
| `/tag/*` | タグページ |
| `/page/[0-9]+` | ページネーション |

### 除外の実行
```bash
grep -v -E '/download/[0-9]+$' urls.txt | \
grep -v -E '/news/[0-9]+$' | \
grep -v -E '/seminar/[0-9]+$' > filtered-urls.txt
```

### ユーザー確認項目
- 除外パターンは適切か
- 追加で除外すべきパターンはあるか
- 除外理由の記録

---

## Step 3: 代表ページの特定

主要な機能・テンプレートをカバーするページを選定します。

### 代表ページの選定カテゴリ（Webサイト向け）

20-25ページを目標に、以下のカテゴリから選定します。

| カテゴリ | 説明 | 目安数 |
|---------|------|-------|
| 入口ページ | トップページ、ランディングページ | 1-2 |
| サービス紹介 | 主要サービス/製品の一覧・詳細 | 4-6 |
| 事例・実績 | 導入事例、実績紹介の一覧・詳細 | 3-4 |
| コンテンツ | 記事、ブログ、メディアの一覧・詳細 | 3-5 |
| フォーム | ユーザー入力を伴うページ（問い合わせ、申込等） | 3-5 |
| 情報ページ | 会社概要、FAQ、サポート、法的ページ | 3-4 |
| 動的UI | モーダル、タブ、アコーディオン等を含むページ | 1-2 |

**選定の原則:**
- 一覧と詳細の両方を含める
- 異なるテンプレート/レイアウトを優先
- ユーザー操作を伴うページを優先

### Webアプリケーションの場合

Webアプリケーションでは以下を優先して選定します：

- 認証画面（ログイン、登録、パスワードリセット）
- ダッシュボード/ホーム
- 一覧・詳細・編集画面（CRUD操作）
- 設定・プロフィール画面
- 検索・フィルター機能
- 通知・アラート表示
- エラー状態（404、権限エラー等）

### コンポーネントライブラリの場合

コンポーネントライブラリは基盤として広く使われるため、**原則として全コンポーネント**を対象とします。

特に重要なコンポーネント：
- フォームコンポーネント（入力、選択、バリデーション）
- ナビゲーションコンポーネント（メニュー、タブ、パンくず）
- モーダル・ダイアログ
- インタラクティブコンポーネント（アコーディオン、ツールチップ）

### 自動分類の例
```bash
case "$url" in
  */products) TYPE="製品一覧" ;;
  */products/*) TYPE="製品詳細" ;;
  */inquiry/*|*/contact/*) TYPE="フォーム" ;;
  */news|*/blog) TYPE="記事一覧" ;;
  */news/*|*/blog/*) TYPE="記事詳細" ;;
esac
```

---

## Step 4: ランダムサンプリング

代表ページを除外したリストからランダム抽出します。

### シード付きランダム抽出
```bash
SEED="wcag-audit-$(date +%Y-%m-%d)"

# 代表ページを除外
grep -xvF -f representative-pages.txt filtered-urls.txt > sampling-pool.txt

# シード付きでランダム抽出
shuf --random-source=<(openssl enc -aes-256-ctr -pass pass:"$SEED" -nosalt </dev/zero 2>/dev/null) \
  -n 10 sampling-pool.txt > random-sample.txt
```

**重要**: シード値を記録して再現可能にします。

---

## Step 5: 重複チェック・統合

代表ページとランダムサンプルを統合し、重複を確認します。

```bash
# 統合
cat representative-pages.txt random-sample.txt > combined-pages.txt

# 重複チェック
DUPLICATES=$(sort combined-pages.txt | uniq -d | wc -l)

# 重複があれば追加抽出
if [ $DUPLICATES -gt 0 ]; then
  grep -xvF -f combined-pages.txt sampling-pool.txt > remaining-pool.txt
  shuf -n $DUPLICATES remaining-pool.txt >> random-sample.txt
fi
```

---

## Step 6: 最終確認

対象ページ一覧をユーザーに提示して承認を得ます。

### 確認項目
- [ ] 代表ページは主要機能をカバーしているか
- [ ] フォームページは入力・確認・完了を含むか
- [ ] 動的コンテンツを含むページがあるか
- [ ] 除外理由は記録されているか
- [ ] シード値は記録されているか

### 出力形式
```markdown
## 対象ページリスト

### 選定パラメータ
- URL収集方法: [sitemap / crawl / ユーザー提供]
- 収集URL総数: X
- 除外パターン: [パターン一覧]
- 除外後URL数: Y
- ランダムシード: [シード値]

### 代表ページ（必須）
| No. | URL | ページタイプ | 選定理由 |
|---|---|---|---|

### ランダムサンプル（補完）
| No. | URL | ページタイプ |
|---|---|---|
```
