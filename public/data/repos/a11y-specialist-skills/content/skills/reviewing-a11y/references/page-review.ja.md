# アクセシビリティ ページレビューガイド

[English](./page-review.md)

**Webページ**のアクセシビリティレビューに特化したガイド。

## 役割

Webページのアクセシビリティ問題をレビューする。WCAG 2.2とWAI-ARIA標準は既知として、このガイドでは利用可能なツールを使った**レビュー方法**に焦点を当てる。

## ツール選択

利用可能なツールに応じてアプローチを選択：

| 利用可能なツール | 能力 | 制限 |
|-----------------|------|------|
| Playwright MCP | アクセシビリティツリー、計算されたrole、視覚的レンダリング | MCPセットアップが必要 |
| WebFetch | HTMLソース、DOM構造 | アクセシビリティツリーなし、JS生成コンテンツ不可 |
| どちらもなし | ページ取得不可 | ユーザーにHTML貼付を依頼 |

### 優先順位

1. **Playwright MCP**（推奨）: 支援技術が実際に「見る」アクセシビリティツリーを提供
2. **WebFetch**: Playwrightが使えない場合のHTML分析フォールバック
3. **ユーザー提供HTML**: 取得ツールがない場合の最終手段

## レビュープロセス

### Playwright MCPがある場合

```
1. ナビゲート: mcp__playwright__browser_navigate でURLにアクセス
2. スナップショット: mcp__playwright__browser_snapshot でキャプチャ:
   - アクセシビリティツリー（主要データソース）
   - 視覚的レンダリング
   - 完全なDOM構造
3. アクセシビリティツリーを分析 - 計算されたrole、名前、状態を確認
```

アクセシビリティツリーは最も信頼できるデータソース - スクリーンリーダーが実際に読み上げる内容を示す。

### WebFetchのみの場合

```
1. 取得: WebFetch でURLからHTMLソースを取得
2. HTML構造を直接分析:
   - セマンティック要素（見出し、ランドマーク、リスト）
   - ソース内のARIA属性
   - 画像のalt属性
   - フォームのラベル関連付け
```

**WebFetch使用時の制限:**
- JavaScriptで生成されたコンテンツは検出不可
- 計算されたアクセシブルネームは検証不可
- 実際のアクセシビリティツリーは見えない
- CSSで非表示にされたコンテンツの問題は検出不可

これらの制限をレポートに記載し、ブラウザベースのテストを推奨する。

### 取得ツールがない場合

PlaywrightもWebFetchも使えない場合：
1. ページを直接取得できないことをユーザーに伝える
2. HTMLソースの貼付またはスクリーンショットの提供を依頼
3. 提供されたコンテンツの静的分析を行う

## 体系的な分析

以下の問題を分析（ツールによって検出可能な項目が異なる）：

| カテゴリ | Playwright | WebFetch |
|----------|------------|----------|
| 見出し構造 | ✅ 計算されたレベル | ✅ HTML要素 |
| ランドマーク | ✅ 計算されたrole | ✅ HTML5/ARIA |
| 画像の代替テキスト | ✅ アクセシブルネーム | ✅ alt属性 |
| フォームラベル | ✅ 計算されたラベル | ⚠️ 関連付けのみ |
| ARIAの妥当性 | ✅ 完全な検証 | ⚠️ 属性の有無のみ |
| キーボードアクセス | ✅ フォーカス可能要素 | ⚠️ tabindexのみ |
| 動的コンテンツ | ✅ 現在の状態 | ❌ 見えない |

**発見した問題の重要度を判定：**
- **Critical**: アクセスが完全に遮断（altなし、ラベルなし、キーボードトラップ）
- **Major**: アクセス可能だが困難（見出し階層の破綻、不明確なリンク）
- **Minor**: 動作するが改善余地あり（冗長なARIA、ベストプラクティス違反）

## 手動確認の必要性をフラグ

常に人間のテストが必要な項目：
- 色コントラスト（色を記録し、ツールでの検証を推奨）
- 完全なキーボードナビゲーションフロー
- 動的インタラクションでのフォーカス管理
- ARIAライブリージョンのアナウンス
- 複数ページ間の一貫性チェック

## 出力フォーマット

### 良い点

良くできている点をリストアップ：
```
- **Good**: 単一のh1（「ページタイトル」）による明確な見出し階層
- **Good**: ナビゲーションメニューがaria-label付きの<nav>ランドマークを使用
- **Good**: すべてのフォームフィールドに可視の関連付けられたラベルがある
```

### 重要度別の問題

**Critical** - アクセスが完全に遮断

フォーマット：
```
- **箇所**: [CSSセレクタまたは説明]
- **問題**: [具体的な問題]
- **WCAG**: [達成基準]（例: 1.1.1 非テキストコンテンツ (A)）
- **影響**: [誰がどのように影響を受けるか]
- **修正案**: [推奨される解決策]
```

**Major** - アクセス可能だが大きな困難を招く

**Minor** - アクセス可能で改善の余地がある

### 手動確認の推奨

```
以下の項目は手動テストが必要です：

1. **色コントラスト**
   - 本文テキストのコントラスト比を確認（#666 on #fff）
   - ボタン状態が3:1の最低基準を満たすか検証

2. **キーボードナビゲーション**
   - Tab/Enter/Spaceですべてのインタラクティブ要素をテスト
   - ドロップダウンメニューのキーボード操作性を確認

3. **フォーカス管理**
   - モーダルを開いた時にフォーカスが移動するか確認
   - 閉じた時にトリガーにフォーカスが戻るか確認
```

## 主要原則

- **最適なツールを使用**: Playwright > WebFetch > ユーザー提供コンテンツ
- **制限について透明に**: チェックできなかった項目を記載
- **具体的に**: 実際の要素を参照（セレクタ、テキスト内容、role）
- **影響度を優先**: Criticalな問題を最初に
- **実行可能な推奨**: 具体的な修正案を提供

## ワークフロー例

### Playwrightがある場合
```
1. ユーザーがURLを提供
2. Playwrightでナビゲート
3. アクセシビリティツリー付きスナップショットをキャプチャ
4. ツリーを上から下へ分析
5. 構造化されたレポートにまとめる
```

### WebFetchのみの場合
```
1. ユーザーがURLを提供
2. WebFetchでHTMLを取得
3. DOM構造を解析
4. セマンティックマークアップとARIAを分析
5. レポートに制限事項を記載
6. ブラウザベースの検証を推奨
```

**覚えておくこと**: 利用可能なツールに応じてアプローチを適応させる。検出できるか不明な場合は控えめにし、手動確認を推奨する。
